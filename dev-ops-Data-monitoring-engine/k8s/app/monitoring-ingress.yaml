apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: monitoring-ingress
  namespace: monitoring
  annotations:
    nginx.ingress.kubernetes.io/use-regex: "true"
    nginx.ingress.kubernetes.io/rewrite-target: /$1  # default rewrite
spec:
  ingressClassName: nginx
  rules:
    - host: localhost
      http:
        paths:
          # RabbitMQ: strip /rabbit → /ui/
          - path: /rabbit(?:/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: rabbitmq-cluster
                port: { number: 15672 }

          # Grafana: prefix only, no rewrite
          - path: /grafana
            pathType: Prefix
            backend:
              service:
                name: grafana
                port: { number: 3000 }

          # Prometheus: prefix only
          - path: /prometheus
            pathType: Prefix
            backend:
              service:
                name: prometheus
                port: { number: 9090 }

          # Node-RED: strip /nodered → /
          - path: /nodered(?:/|$)(.*)
            pathType: ImplementationSpecific
            backend:
              service:
                name: nodered
                port: { number: 1880 }
